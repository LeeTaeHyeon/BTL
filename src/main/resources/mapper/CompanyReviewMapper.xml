<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.btl.findjob.mapper.CompanyReviewMapper">

    <!--	current_timestamp를 사용하여 현재 시간 입력 userid와 회사 아이디는 임시로 1번에 저장하도록한다.-->

    <insert id="insertCompanyReview">
        insert into companyreview (cr_comment, cr_starRt, cr_regDate, cr_category, user_id, ci_id)
        values (#{cr_comment}, #{cr_starRt}, now(), #{cr_category}, 1, #{ci_id})
    </insert>

    <select id="getListWithPaging" resultType="com.btl.findjob.model.CompanyReview">
        select cr_id, cr_comment, cr_starRt, cr_regDate, cr_category, user_id, ci_id
        from companyreview
        where ci_id = #{ci_id}
        order by cr_id desc
        LIMIT #{companyReviewCriteria.pageStart},#{companyReviewCriteria.amount}
    </select>

    <select id="getCountByCi_id" resultType="int">
        select count(ci_id)
        from companyreview
        where ci_id = #{ci_id}
    </select>

    <select id="getStarRtAvg" resultType="double">
        select IFNULL(avg(cr_starRt),0) from companyreview, companyinfo
        where cr_category = #{cr_category} and ci_companyName = #{ci_companyName}
#         group by cr_category,ci_companyName;
    </select>


</mapper>